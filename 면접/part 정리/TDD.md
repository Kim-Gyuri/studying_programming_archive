# 📌 개발상식

+ TDD란 무엇인가
+ 테스트 코드를 먼저 작성해야 하는 이유
+ TDD 방법
+ 리팩토링
+ 리팩토링을 해야 하는 이유
+ TDD에 대한 토론
  +  junit을 기반으로 하는 단위 테스트에 대해서 
  +  그래서 TDD는 왜 해야 할까?
  +  테스트 코드가 길어지면 어떡하나요?
  +  코드 생산성에 문제가 있지는 않나?
  +  테스트 코드를 작성하기가 쉬운가?
  +  모든 상황에 대해서 테스트 코드를 작성할 수 있는가?
+ Spring에서의 TDD

## TDD란 무엇인가
테스트 코드를 먼저 작성하는 개발 방법론 (Test-Driven Development)을 말한다. <br> 일단 테스트 통과하는 코드를 작성하고 상황에 맞게 리팩토링하는 과정을 거친다. <br>

## 테스트 코드를 먼저 작성해야 하는 이유
+ `궁극적인 목표` 깔끔한 코드 작성  
+ 장기적 개발 비용 절감
+ 개발이 끝나고 테스트 코드 작성하는 것은 매우 귀찮은 작업  (실패 케이스  과정이 매우 귀찮아진다.)
+ 그 중에서도 실패 테스트부터 작성해야 한다.

> `깔금한 코드를 작성하는 것` <br>
> TDD의 개발 단계에는 "리팩토링"이 있다, <br>
> 이 리팩토링 과정을 거치면서 중복된 코드들은 제거되고, 복잡한 코드들은 깔끔하게 정리하게 된다. <br><br>
> `장기적으로 보면 개발 비용 절감` <br>
> 처음 작성할 때 "귀찮고 개발을 느리게 한다"라고 느낄 수 있지만, 장기적으로 보면 개발 비용을 아껴줄 것 <br> <br>
> `개발이 끝나고 테스트 코드 작성하는 것은 매우 귀찮은 작업` <br>
> (사실상 주관적 견해) 정말 현실적인 이야기이다. <br>
> product code를 먼저 작성하였다면 이후에 테스트 코드를 작성하는 과정은 너무 귀찮다. <br>
> 테스트 코드는 성공 케이스 뿐만 아니라 실패 케이스까지 작성해야 하기 때문에 <br>
>  작성해야 할 테스트의 개수는 해당 함수에서 발생 가능한 모든 경우 N개가 된다. <br>
>  이미 개발이 완료되었기에 끝났다는 심리적 요인 때문에 테스트를 작성하는 것이 꺼려진다. <br><br>
> `실패 테스트부터 작성해야 한다.` <br>
> 순차적으로 실패하는 테스트를 먼저 작성하고, 오직 테스트가 실패할 경우에만 새로운 코드를 작성해야 한다. <br>
> 그 다음 중복된 코드가 있다면 제거한다. <br>

## TDD 방법
TDD 개발 방법론의 프로그래밍 순서는 매우 단순하다.  <br>
+ `1` 실패하는 작은 단위 테스트를 작성한다. 처음에는 컴파일조차 되지 않을 수 있다.  <br>
+ `2` 빨리 테스트를 통과하기 위해 프로덕션 코드를 작성한다. 이를 위해 정답이 아닌 가짜 구현 등을 작성할 수도 있다.  <br>
+ `3` 그 다음의 테스트 코드를 작성한다. 실패 테스트가 없을 경우에만 성공 테스트를 작성한다.  <br>
+ `4` 새로운 테스트를 통과하기 위해 프로덕션 코드를 추가 또는 수정한다.  <br>
+ `5` 1~4단계를 반복하여 실패/성공의 모든 테스트 케이스를 작성한다.  <br>
+ `6` 개발된 코드들에 대해 모든 중복을 제거하며 리팩토링한다.  <br>
> `참고`  Spring과 같은 프레임워크에 TDD를 적용하는 것은 다른 영역이다. ATDD(Application TDD)라고 불린다. 

## 리팩토링
좋은 코드? 코드를 작성할 때 고려해야 할 요소는 뭘까? <br>
+ coding convertion (가독성 높인다.)
+ 네이밍 규칙
+ 확장석 고려
+ 비지니스 로직에 대한 고려
+ 예외처리

> coding convertion : 작성한 코드를 다른사람들도 쉽게 이해할 수 있게 가독성 있는 코드를 작성하는법에 대한 규칙이다. <br>
> 네이밍 규칙 : 메소드명, 변수명, 클래스명에 일관성을 준다.

## 리팩토링을 해야 하는 이유
코드량이 많은 경우, 끊임없이 발견되는 버그들을 디버깅하는 과정에서 코드가 더렵혀진다. <br>
이때 테스트 주도 개발을 통해 개발을 해왔다면, 테스트 코드가 그 중심을 잡아줄 수 있다. <br>
객체지향이고 확장 가능이 용이한,  재설계 시간 단축, 디버깅 시간이 단축되는 코드를 기대할 수 있다. <br>

## TDD에 대한 토론
###  junit을 기반으로 하는 단위 테스트에 대해서 
가능하면 단위 테스트를 만들려고 한다. <br>
#### 장점 :빠른 피드백
단위 테스트가 있으면 개발과 테스트 사이클이 짧아진다. (다양한 시도가 가능해진다) <br>
> `예 : jpa기반 개발` <br>
> jpa를 기반으로 개발하면서 매핑이 잘 됐는지 확인하거나, <br>
> 의도한대로 sqp 쿼리가 생성되었는지 확인하기 위한 테스트 코드를 만드는 경우. <br>
> 이 부분은 단위 테스트가 아니라 통합 테스트라고 하는 것이 맞겠지만, <br>
> 내가 의도한대로 동작하는지를 확인하기에는 (단위테스트)가 유용하다. <br><br><br>
> `번외 : ORM을 처음 사용해봤을 때 느낀점` <br>
>내가 의도한대로 동작하지 않아서 삽질 하는 경우가 많다. <br>
>이런 경우, 테스트 코드를 만들어 계속 실행해가면서 내가 의도한 형태의 매핑을 구현할 수 있다. <br><br><br>
> `번외 : javascript의 validation 기능을 사용할 때` <br>
> [qunit](http://qunitjs.com/)을 사용해서, 단위 테스트 코드를 만들고 테스트를 진행했는데 유용했다고 하심.

<br>

###  그래서 TDD는 왜 해야 할까?
개인적인 생각으로는 TDD를 하지 않으면 <br>
테스트가 필요한 부분에 단위 테스트 코드를 만들지 않고 Production code를 만드는 경험을 종종 한다. <br>
Production 코드를 만들고 잘 동작하면 이후에, 테스트 코드를 추가하는 것은 정말 쉽지 않다. <br>
결국 "TDD를 연습하고 적극적으로 활용하는 것이 중요하다"  라고 느낀다. <br>

<br>

###  테스트 코드가 길어지면 어떡하나요?
```
"100줄짜리 코드를 테스트 하기 위해 200줄짜리 테스트 코드를 짜야 하나요?" 
```
TDD는 개발하는데 추가시간이 소모되는 개발방법이다. <br>
"30초 or 1분을 주기로 계속해야 테스트를 돌려야 하니 당연하지 않은가?" <br>
하지만 그로 인해 쌓이는 테스트 케이스들은 개발 완료 후 리팰토링을 위해 소스의 구조를 바꿔야 하는 경우, <br>
기능 추가 등의 요구사항이 들이 닥쳤을 때 소중한 자산이 될 것이다. (부작용 예방차원) <br>
> 각종 테스트 중에서도 가장 예측하기 힘들고 테스트 하기도 귀찮고 어려운게 회귀 테스트인데 테스트 케이스만 잘 갖춰져 있으면  <br>
> 테스트에 스트레스 받을 일이 줄어들기 때문이다.

본론, 100줄짜리 코드를 테스트 하기 위해 200줄짜리 코드가 필요한 모듈이라면 <br> 그만큼 의존하는 부분이 많고 중요한 로직이다.
> 향후 테스트 할일이 더 많다. <br> 경우 수를 생각한다면, 그때마다 한줄 수정하고 직접 테스트 하느라 시간 보내는 것보다 <br> 처음 200줄짜리 코드를 만들어 놓고 관리하는 게 낫다.

<br>

###  코드 생산성에 문제가 있지는 않나?
TDD 경우, 코드량이 늘어난다. <br>
코드 퀄리티보다 빠른 생산성이 요구되는 경우 TDD는 걸림돌이 된다.<br>

<br>

###  테스트 코드를 작성하기가 쉬운가?
여러 부분에 대해 고려해야 한다.
+ 어떠한 부분을 테스트 해야 하는가?
+ 어떻게 테스트 해야 하는가?
+ 여러 테스트 프레임워크 중 어떤 것이 우리의 서비스와 맞는지?

<br>

###  모든 상황에 대해서 테스트 코드를 작성할 수 있는가?
+ 테스트 코드를 작성하기 위해 더 많은 작업이 필요한 경우 <br> 실제 구현 코드보다 방대해진 코드를 관리하는 것은 매우 어렵다.
+ 모든 코드에 대해서 테스트 코드를 작성할 수 없으며 작성할 필요도 없다.
+ 테스트 코드를 작성해도 버그가 발생할 수도 있다.

> `참고` [TDD는 죽었는가? 글 참고](https://jinson.tistory.com/271) <br>
> 요약: "페이스북 해커톤에서 절반은 TDD가 가능했으나 절반은 그렇지 않았다." <br>
> TDD를 하지 않은 절반은 "테스트를 하지 않은 것"은 아니고  <br>
> "TDD 스타일이 아닌 재발(regression) 테스트와 짧은 피드백 루프를 사용한다"는 언급이 있다. <br>
> 전반적으로 테스트는 필요하다.

## Spring에서의 TDD
+ Repository -> Service -> Controller 순서로 개발을 진행한다.
+ Repository 계층의 테스트는 H2와 같은 인메모리 데이터베이스 기반의 통합 테스트로 진행한다.
+ Service 계층의 테스트는 Mockito를 사용해 Repository 계층을 Mock하여 진행한다.
+ Controller 계층의 테스트는 SpringTest의 MockMvc를 사용해 진행한다.

> 이러한 내용을 숙지했다고 하더라도 실제로 TDD를 적용하는 것은 쉽지 않다.  <br>
> 다음 블로그 [단위 테스트 - 참고하기 좋은 글](https://mangkyu.tistory.com/144)를 읽어보자.
